{"version":3,"sources":["../src/Statix.js"],"names":[],"mappings":"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","file":"Statix.js","sourcesContent":["var connect = require('connect');\nvar http = require('http');\nvar serveStatic = require('serve-static');\nvar connectLiveReload = require('connect-livereload');\nvar liveReload = require('livereload');\nvar glob = require('glob');\nvar fs = require('fs');\nvar vfs = require('vinyl-fs');\nvar gaze = require('gaze');\n\nclass Statix {\n    constructor(configuration) {\n        this._createConfigurationDefaults(configuration);\n        this.middleware = this._configuration.middleware;\n        this.watchFunctions = [];\n    }\n\n    _runMiddleware() {\n        var length = this.middleware.length - 1;\n        var currentRunning = 0;\n\n        var run = function() {\n            this._setUpMiddleware(this.middleware[currentRunning]).then(function() {\n                if (currentRunning < length) {\n                    currentRunning ++;\n                    run();\n                } else {\n                    this.watchFunctions.forEach(function(func) {\n                        func();\n                    });\n                }\n            }.bind(this));\n        }.bind(this);\n\n        return run();\n    }\n\n    _setUpMiddleware(middleware) {\n        var directories = this._getMiddlewareDirectories(middleware.directories);\n\n        if (middleware.watch !== false) {\n            this.watchFunctions.push(function() {\n                gaze(directories, function(err, watcher) {\n                    console.log('watching');\n\n                    watcher.on('all', function(event, filepath) {\n                        console.log('watcher triggered', filepath);\n                        middleware.run(this._configuration.sourceFolder, this._configuration.tmpFolder, middleware.configuration, filepath);\n                    }.bind(this));\n                }.bind(this));\n            }.bind(this));\n        }\n\n        return middleware.run(\n            this._configuration.sourceFolder,\n            this._configuration.tmpFolder,\n            middleware.configuration,\n            directories);\n\n    }\n    \n    _getMiddlewareDirectories(middlewareDirectories) {\n        var directories = middlewareDirectories;\n\n        if (middlewareDirectories === undefined) {\n            return [];\n        }\n\n        if (middlewareDirectories.include) {\n            directories = [];\n            middlewareDirectories.include.forEach(function(path) {\n                directories.push(`${path}`);\n            });\n        }\n\n        if (middlewareDirectories.exclude) {\n            middlewareDirectories.exclude.forEach(function(path) {\n                directories.push(`!${path}`);\n            });\n        }\n\n\n        directories.forEach(function(directory, i) {\n            if (directory.slice(0, 1) === '!') {\n                directory= directory.slice(1, directory.length);\n                directories[i] = `!${this._configuration.sourceFolder}${directory}`\n            } else {\n                directories[i] = `${this._configuration.sourceFolder}${directory}`\n            }\n        }.bind(this));\n\n        return directories;\n    }\n    \n    _createConfigurationDefaults(configuration) {\n        this._configuration = configuration;\n        this._configuration.tmpFolder = `${process.cwd()}/.tmp`;\n\n        if (isNaN(this._configuration.port) === false) {\n            this._configuration.port = 9000;\n        }\n    }\n\n    _initiateLiveReload() {\n        var server = liveReload.createServer();\n        server.watch(this._configuration.tmpFolder);\n    }\n\n    server() {\n       this._runMiddleware();\n\n        var app = connect();\n        if (this._configuration.useFileWatch === true) {\n            app.use(connectLiveReload());\n            this._initiateLiveReload();\n        }\n\n        app.use(serveStatic(this._configuration.tmpFolder));\n\n        var server = http.createServer(app).listen(this._configuration.port);\n    }\n\n    build() {\n        console.log('building');\n    }\n}\n\nmodule.exports = Statix;"]}