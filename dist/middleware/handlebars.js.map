{"version":3,"sources":["../../src/middleware/handlebars.js"],"names":[],"mappings":"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","file":"handlebars.js","sourcesContent":["var handlebars = require('handlebars');\nvar hbLayouts = require('handlebars-layouts');\nvar fs = require('fs');\nvar vfs = require('vinyl-fs');\nvar map = require('map-stream');\n\nvar helpers = (function() {\n    var isDir = function(filename) {\n        var stats = fs.statSync(filename);\n        return stats && stats.isDirectory();\n    };\n\n    var registerPartials = function(dir, base) {\n        base = base || dir;\n        fs.readdirSync(dir).forEach(function (basename) {\n            var filename = dir + '/' + basename;\n            if (isDir(filename)) {\n                registerPartials(filename, base);\n            } else {\n                registerPartial(filename, base);\n            }\n        }.bind(this));\n    };\n\n    var registerPartial  = function(filename, base) {\n        if (!isHandleBars(filename)) { return; }\n        var name = partialName(filename, base);\n        var template = fs.readFileSync(filename, 'utf8');\n        handlebars.registerPartial(name, template);\n    };\n\n    var isHandleBars = function(filename) {\n        return ['hbs'].indexOf(filename.split('.').pop()) !== -1;\n    };\n\n    var partialName  = function(filename, base) {\n        var name = filename.substr(0, filename.lastIndexOf('.'));\n        name = name.replace(new RegExp('^' + base + '\\\\/'), '');\n        return name.substring(name.charAt(0) === '_' ? 1 : 0);\n    };\n\n    return {\n        isDir,\n        registerPartials,\n        registerPartial,\n        isHandleBars,\n        partialName\n    }\n}());\n\nmodule.exports = function(sourceFolder, targetFolder, configuration, filePathsArg) {\n    handlebars.registerHelper(hbLayouts(handlebars));\n\n    var templateData = {\n        data: configuration.templateData\n    };\n\n    var options = {\n        batch :  configuration.batch,\n        helpers : configuration.helpers\n    };\n\n    // Go through a partials directory array\n    if(options.batch !== undefined && options.batch.length > 0){\n        options.batch.forEach(function (dir) {\n            helpers.registerPartials(dir, dir);\n        }.bind(this));\n    }\n\n    var compileHandleBars = function(file, cb) {\n        var html = file.contents.toString();\n        handlebars.registerHelper(options.helpers);\n        var template = handlebars.compile(html);\n        var result = template(templateData);\n        file.contents = new Buffer(result);\n        cb(null, file);\n    };\n\n    var rename = function(file, cb) {\n        var length = file.basename.length;\n\n        file.basename = file.basename.slice(0, length - 4); // remove .hbs\n        cb(null, file);\n    };\n\n    var logChange = function(file, cb) {\n        cb(null, file);\n    };\n\n    var action = function(cb) {\n        vfs.src(filePathsArg)\n            .pipe(map(compileHandleBars))\n            .pipe(map(rename))\n            .pipe(vfs.dest(targetFolder))\n            .on('finish', function() {\n                cb();\n            });\n    };\n\n    var promise = new Promise(function(resolve, rej) {\n        action(resolve);\n    });\n\n    return promise;\n};"]}